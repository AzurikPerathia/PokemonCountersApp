<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Pokemon Counters</title>

<style>
@font-face {
    font-family: 'Delfino';
    src: url('./Delfino.ttf') format('truetype');
}

body {
    margin: 0;
    padding: 8px;
    background: #0b3d0b;
    font-family: Delfino, Arial, sans-serif;
}

h2 {
    text-align: center;
    margin: 6px 0;
    font-size: 28px;
    color: white;
}

.section { margin-bottom: 10px; }

.grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

/* ===== COUNTERS ===== */
.counter {
    background: #1db01d;
    border-radius: 14px;
    padding: 6px;
    height: 150px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.counter-name {
    border: none;
    background: transparent;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    color: black;
}

.counter-value {
    text-align: center;
    font-size: 44px;
    color: white;
}

.controls {
    display: flex;
    justify-content: center;
    gap: 6px;
    align-items: center;
}

button {
    width: 48px;
    height: 48px;
    font-size: 24px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
}

.cheat {
    width: 70px;
    font-size: 18px;
    text-align: center;
}

.link {
    font-size: 16px;
}

/* ===== TIMERS ===== */
.timer-box {
    background: white;
}

.timer-name {
    color: #0050ff;
    font-size: 26px;
    text-align: center;
}

.timer-value {
    color: #0050ff;
    font-size: 38px;
    text-align: center;
}

/* ===== TEMPLATES ===== */
.templates {
    background: #e8ffe8;
    border-radius: 12px;
    padding: 8px;
    margin-bottom: 10px;
}

.templates h3 {
    text-align: center;
    margin: 4px;
    color: black;
}

.template-row {
    display: flex;
    gap: 6px;
    margin-bottom: 6px;
}

.template-row button {
    width: auto;
    padding: 6px 10px;
    font-size: 16px;
}

.template-row input {
    flex: 1;
    font-size: 16px;
}
</style>
</head>

<body>

<!-- ===== TEMPLATES ===== -->
<div class="templates">
<h3>Favoris / Templates</h3>

<div class="template-row">
    <input id="templateName" placeholder="Nom du template">
    <button onclick="saveTemplate()">üíæ Sauver</button>
</div>

<div id="templateList"></div>
</div>

<!-- ===== CHRONOS ===== -->
<div class="section">
<h2>Chronom√®tres</h2>
<div class="grid">

<div class="counter timer-box">
    <div class="timer-name">Chrono Y / M / D / H / M / S</div>
    <div class="timer-value" id="timerFull">0y 0m 0d 00:00:00</div>
    <div class="controls">
        <button onclick="toggleTimer('full')">‚ñ∂</button>
        <button onclick="resetTimer('full')">‚ü≤</button>
    </div>
</div>

<div class="counter timer-box">
    <div class="timer-name">Chrono D / H / M / S</div>
    <div class="timer-value" id="timerShort">0d 00:00:00</div>
    <div class="controls">
        <button onclick="toggleTimer('short')">‚ñ∂</button>
        <button onclick="resetTimer('short')">‚ü≤</button>
    </div>
</div>

</div>
</div>

<!-- ===== STATS ===== -->
<div class="section">
<h2>Stats Globale</h2>
<div class="grid" id="stats"></div>
</div>

<!-- ===== POK√âMON ===== -->
<div class="section">
<h2>Pok√©mon Catch</h2>
<div class="grid" id="catch"></div>
</div>

<script>
/* üîí CL√â IMMUTABLE (NE JAMAIS CHANGER) */
const STORAGE_KEY = "pokemonCounters_v1";

/* ===== CHARGEMENT SAFE ===== */
let store = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
store.counters ??= {};
store.timers ??= {};
store.templates ??= {};

store.timers.full ??= { run:false, elapsed:0, last:0 };
store.timers.short ??= { run:false, elapsed:0, last:0 };

function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(store));
}

/* ===== COUNTERS ===== */
let activeCounter = null;

function createCounter(container, id, defaultName) {
    if (!store.counters[id]) {
        store.counters[id] = { value: 0, name: defaultName };
    }

    const el = document.createElement("div");
    el.className = "counter";
    el.onclick = () => activeCounter = id;

    el.innerHTML = `
        <input class="counter-name" value="${store.counters[id].name}"
            onblur="rename('${id}', this.value)">
        <div class="counter-value" id="v-${id}">${store.counters[id].value}</div>
        <div class="controls">
            <button onclick="event.stopPropagation();apply(-1)">‚àí</button>
            <button onclick="event.stopPropagation();apply(1)">+</button>
            <input class="cheat" type="number" placeholder="Set"
                onkeydown="cheat(event,'${id}')">
            <label class="link">‚òë <input type="checkbox" class="check" data-id="${id}"></label>
        </div>
    `;
    container.appendChild(el);
}

function getTargets() {
    const checked = [...document.querySelectorAll(".check:checked")].map(c => c.dataset.id);
    return checked.length ? checked : (activeCounter ? [activeCounter] : []);
}

function apply(delta) {
    getTargets().forEach(id => {
        store.counters[id].value = Math.max(0, store.counters[id].value + delta);
        document.getElementById("v-" + id).textContent = store.counters[id].value;
    });
    save();
}

function cheat(e, id) {
    if (e.key === "Enter") {
        store.counters[id].value = Math.max(0, parseInt(e.target.value) || 0);
        document.getElementById("v-" + id).textContent = store.counters[id].value;
        e.target.value = "";
        save();
    }
}

function rename(id, val) {
    store.counters[id].name = val;
    save();
}

/* ===== KEYBOARD ===== */
document.addEventListener("keydown", e => {
    if (e.key === "+" || e.key === "=") apply(1);
    if (e.key === "-" || e.key === "_") apply(-1);
});

/* ===== TEMPLATES ===== */
function saveTemplate() {
    const name = templateName.value.trim();
    if (!name) return;
    store.templates[name] = [...document.querySelectorAll(".check:checked")].map(c => c.dataset.id);
    templateName.value = "";
    save();
    renderTemplates();
}

function applyTemplate(name) {
    document.querySelectorAll(".check").forEach(c => c.checked = false);
    store.templates[name].forEach(id => {
        const el = document.querySelector(`.check[data-id="${id}"]`);
        if (el) el.checked = true;
    });
}

function deleteTemplate(name) {
    delete store.templates[name];
    save();
    renderTemplates();
}

function renderTemplates() {
    templateList.innerHTML = "";
    Object.keys(store.templates).forEach(name => {
        const row = document.createElement("div");
        row.className = "template-row";
        row.innerHTML = `
            <button onclick="applyTemplate('${name}')">‚≠ê ${name}</button>
            <button onclick="deleteTemplate('${name}')">üóë</button>
        `;
        templateList.appendChild(row);
    });
}

/* ===== TIMERS ===== */
let intervals = {};

function format(ms, full) {
    let s = Math.floor(ms / 1000);
    let y = Math.floor(s / 31536000); s %= 31536000;
    let mo = Math.floor(s / 2592000); s %= 2592000;
    let d = Math.floor(s / 86400); s %= 86400;
    let h = String(Math.floor(s / 3600)).padStart(2, "0");
    let m = String(Math.floor((s % 3600) / 60)).padStart(2, "0");
    let se = String(s % 60).padStart(2, "0");
    return full ? `${y}y ${mo}m ${d}d ${h}:${m}:${se}` : `${d}d ${h}:${m}:${se}`;
}

function updateTimer(t) {
    const o = store.timers[t];
    const v = o.elapsed + (o.run ? Date.now() - o.last : 0);
    document.getElementById(t === "full" ? "timerFull" : "timerShort").textContent =
        format(v, t === "full");
}

function toggleTimer(t) {
    const o = store.timers[t];
    if (o.run) {
        o.elapsed += Date.now() - o.last;
        o.run = false;
        clearInterval(intervals[t]);
    } else {
        o.run = true;
        o.last = Date.now();
        intervals[t] = setInterval(() => updateTimer(t), 500);
    }
    save();
}

function resetTimer(t) {
    store.timers[t] = { run:false, elapsed:0, last:0 };
    updateTimer(t);
    save();
}

/* ===== INIT ===== */
renderTemplates();
["full","short"].forEach(t => {
    updateTimer(t);
    if (store.timers[t].run) {
        store.timers[t].last = Date.now();
        intervals[t] = setInterval(() => updateTimer(t), 500);
    }
});

const stats = document.getElementById("stats");
createCounter(stats, "shiny", "Total Shiny Encounters");
createCounter(stats, "total", "Total Encounters");
createCounter(stats, "phase", "Phase Encounters");

const c = document.getElementById("catch");
for (let i = 1; i <= 10; i++) {
    createCounter(c, "p" + i + "_phase", "Phase " + i);
    createCounter(c, "p" + i + "_total", "Total " + i);
}
</script>

</body>
</html>